{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block extra_head %}
    <link href="{% static 'css/nutrition-facts.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container">
<h1>{{ main.food_code }} {{ main.main_food_description }} {{ mainNutval.0.nutrient_code }}</h1>
<div class="row">
    <div class="col">
        <section class="performance-facts">
      <header class="performance-facts__header">
      <div class="container">
          <div class="row">
              <h1 class="performance-facts__title">Nutrition Facts</h1>
          </div>
          <div class="row">
              <div class="col-5">
                  <p class="text-left" id="servingSize">Serving Size <span id="servingSizeNum">100</span>g</p>
              </div>
              <div class="col-7">
                  <div class="dropdown show text-right">
              <a class="btn btn-sm btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Measure Description
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                  <p class="dropdown-item portion" id="portion">100 g - <span class="portion_number">100</span> g</p>
                  {% for weight in main.Weights.all %}
                      <p class="dropdown-item portion" id="portion{{ forloop.counter0 }}">{{ weight.portion_code.portion_description }} - <span class="portion_number{{ forloop.counter0 }}">{{ weight.portion_weight }}</span> g</p>
                  {% endfor %}
              </div>
            </div>
              </div>

          </div>
      </div>
      </header>
      <table class="performance-facts__table">
        <thead>
          <tr>
            <th colspan="3" class="small-info">
              Amount Per Serving
            </th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th colspan="2">
              <b>Calories</b>
              <span class="nutrient" id="{{ ENERC_KCAL.tagname }}">{{ ENERC_KCAL.value }}</span>
            </th>
            <td>
              Calories from Fat
              130
            </td>
          </tr>
          <tr class="thick-row">
            <td colspan="3" class="small-info">
              <b>% Daily Value*</b>
            </td>
          </tr>
          <tr>
            <th colspan="2">
              <b>Total Fat</b>
                <span class="nutrient" id="{{ FAT.tagname }}">{{ FAT.value }}</span> g
            </th>
            <td>
              <b>{{ FATpercentDaily }}</b>
            </td>
          </tr>
          <tr>
            <td class="blank-cell">
            </td>
            <th>
              Saturated Fat
                <span class="nutrient" id="{{ FASAT.tagname }}">{{ FASAT.value }}</span> g
            </th>
            <td>
              <b>{{ FASATpercentDaily }}</b>
            </td>
          </tr>
          <tr>
            <td class="blank-cell">
            </td>
            <th >
              Trans Fat
              0g
            </th>
            <td>
            </td>
          </tr>
          <tr>
            <th colspan="2">
              <b>Cholesterol</b>
                <span class="nutrient" id="{{ CHOLE.tagname }}">{{ CHOLE.value }}</span> mg
            </th>
            <td>
              <b>18%</b>
            </td>
          </tr>
          <tr>
            <th colspan="2">
              <b>Sodium</b>
                <span class="nutrient" id="{{ NA.tagname }}">{{ NA.value }}</span> mg
            </th>
            <td>
              <b>2%</b>
            </td>
          </tr>
          <tr>
            <th colspan="2">
              <b>Total Carbohydrate</b>
                <span class="nutrient" id="{{ CHOCDF.tagname }}">{{ CHOCDF.value }}</span> g
            </th>
            <td>
              <b>6%</b>
            </td>
          </tr>
          <tr>
            <td class="blank-cell">
            </td>
            <th>
              Dietary Fiber
                <span class="nutrient" id="{{ FIBTG.tagname }}">{{ FIBTG.value }}</span> g
            </th>
            <td>
              <b>4%</b>
            </td>
          </tr>
          <tr>
            <td class="blank-cell">
            </td>
            <th>
              Sugars
                <span class="nutrient" id="{{ SUGAR.tagname }}">{{ SUGAR.value }}</span> g
            </th>
            <td>
            </td>
          </tr>
          <tr class="thick-end">
            <th colspan="2">
              <b>Protein</b>
                <span class="nutrient" id="{{ PROCNT.tagname }}">{{ PROCNT.value }}</span> g
            </th>
            <td>
            </td>
          </tr>
        </tbody>
      </table>

      <table class="performance-facts__table--grid">
        <tbody>
          <tr>
            <td colspan="2">
              Vitamin A
                <span class="nutrient " id="{{ VITA_RAE.tagname }}">{{ VITA_RAE.value }}</span> mcg_RAE
            </td>
            <td>
              Vitamin C
                <span class="nutrient" id="{{ VITC.tagname }}">{{ VITC.value }}</span> mg
            </td>
          </tr>
          <tr class="thin-end">
            <td colspan="2">
              Calcium
                <span class="nutrient" id="{{ CA.tagname }}">{{ CA.value }}</span> mg
            </td>
            <td>
              Iron
                <span class="nutrient" id="{{ FE.tagname }}">{{ FE.value }}</span> mg
            </td>
          </tr>
        </tbody>
      </table>

      <p class="small-info">* Percent Daily Values are based on a {{ calories }} calorie diet.</p>

      <table class="performance-facts__table--small small-info">
        <thead>
          <tr>
            <td colspan="2"></td>
            <th>Calories:</th>
            <th>{{ calories }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th colspan="2">Total Fat</th>
            <td>Less than</td>
            <td>65g</td>
          </tr>
          <tr>
            <td class="blank-cell"></td>
            <th>Saturated Fat</th>
            <td>Less than</td>
            <td>{{ totalFat }}g</td>
          </tr>
          <tr>
            <th colspan="2">Cholesterol</th>
            <td>Less than</td>
            <td>300mg</td>
            <td>300 mg</td>
          </tr>
          <tr>
            <th colspan="2">Sodium</th>
            <td>Less than</td>
            <td>2,400mg</td>
            <td>2,400mg</td>
          </tr>
          <tr>
            <th colspan="3">Total Carbohydrate</th>
            <td>300g</td>
            <td>375g</td>
          </tr>
          <tr>
            <td class="blank-cell"></td>
            <th colspan="2">Dietary Fiber</th>
            <td>25g</td>
            <td>30g</td>
          </tr>
        </tbody>
      </table>

      <p class="small-info">
        Calories per gram:
      </p>
      <p class="small-info text-center">
        Fat 9
        &bull;
        Carbohydrate 4
        &bull;
        Protein 4
      </p>

    </section>
    </div>
    <div class="col">
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th>Nutrient</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>

                {% for x in mainNutVal %}
                    <tr>
                    <td>
                        {{ x.nutrient_code.nutrient_description }}
                    </td>
                    <td>
                        <span class="nutrient" id="{{ x.nutrient_code.tagname }}1">{{ x.nutrient_value }}</span>
                    </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

</div>


{% endblock %}
{% block extra_scripts %}
<script>
    const portion = document.getElementsByClassName("portion");
    const nutrient = document.getElementsByClassName("nutrient");
    const factslist = ["FE", "CA", "VITC", "VITA_RAE", "PROCNT", "SUGAR", "FIBTG", "CHOCDF", "NA", "CHOLE", "FAT", "FASAT", "ENERC_KCAL"]
    for(let x=0; x<portion.length; x++){
        portion[x].addEventListener("click", function(){
            let portionNum = portion[x].firstElementChild.textContent
            document.getElementById("servingSizeNum").textContent = portionNum.toString()
            for (let i=0; i<nutrientObjs.tagname.length; i++){
                if (factslist.includes(nutrientObjs.tagname[i])) {
                    document.getElementById(nutrientObjs.tagname[i]).textContent = (((nutrientObjs.nutrient_value[i] * portionNum / 100).toFixed(2)).toString())
                }
                document.getElementById(nutrientObjs.tagname[i]+"1").textContent = (((nutrientObjs.nutrient_value[i] * portionNum / 100).toFixed(2)).toString())
            }
        })
    };

    function createPortionCodeObj(portion_code, portion_description, portion_weight){
        return {
            portion_code: portion_code,
            portion_description: portion_description,
            portion_weight: portion_weight,
        }
    };

        let portionObj = {
            portion_code:
                {% for weight in main.Weights.all %}
                    {% if forloop.first %}
                        [{{ weight.portion_code.portion_code }},
                    {% elif forloop.last %}
                        {{ weight.portion_code.portion_code }}]
                    {% else %}
                        {{ weight.portion_code.portion_code }},
                    {% endif %}
                {% endfor %},
            portion_description:
                {% for weight in main.Weights.all %}
                    {% if forloop.first %}
                        ["{{ weight.portion_code.portion_description }}",
                    {% elif forloop.last %}
                        "{{ weight.portion_code.portion_description }}"]
                    {% else %}
                        "{{ weight.portion_code.portion_description }}",
                    {% endif %}
                {% endfor %},
            weight:
            {% for weight in main.Weights.all %}
                {% if forloop.first %}
                    [{{ weight.portion_weight }},
                {% elif forloop.last %}
                    {{ weight.portion_weight }}]
                {% else %}
                    {{ weight.portion_weight }},
                {% endif %}
            {% endfor %}
        };

    let nutrientObjs = {
       tagname:
           {% for x in mainNutVal %}
                {% if forloop.first %}
                    ["{{ x.nutrient_code.tagname }}",
                {% elif forloop.last %}
                    "{{ x.nutrient_code.tagname }}"]
                {% else %}
                    "{{ x.nutrient_code.tagname }}",
                {% endif %}
            {% endfor %},
        nutrient_description:
            {% for x in mainNutVal %}
                {% if forloop.first %}
                    ["{{ x.nutrient_code.nutrient_description }}",
                {% elif forloop.last %}
                    "{{ x.nutrient_code.nutrient_description }}"]
                {% else %}
                    "{{ x.nutrient_code.nutrient_description }}",
                {% endif %}
            {% endfor %},
        nutrient_value:
        {% for x in mainNutVal %}
            {% if forloop.first %}
                [{{ x.nutrient_value }},
            {% elif forloop.last %}
                {{ x.nutrient_value }}]
            {% else %}
                {{ x.nutrient_value }},
            {% endif %}
        {% endfor %}
    };
</script>

{% endblock %}